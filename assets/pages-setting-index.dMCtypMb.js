var a=(a,e,l)=>new Promise((t,s)=>{var n=a=>{try{u(l.next(a))}catch(e){s(e)}},c=a=>{try{u(l.throw(a))}catch(e){s(e)}},u=a=>a.done?t(a.value):Promise.resolve(a.value).then(n,c);u((l=l.apply(a,e)).next())});import{r as e,k as l,q as t,c as s,w as n,i as c,o as u,a as o,e as i,p as d,v as r,t as f,l as v,m as _,f as m,n as y,x as h,y as g}from"./index-DvadhCu2.js";import{_ as p,g as k,f as b,a as x,c as j}from"./_plugin-vue_export-helper.CQNFGRkO.js";const C=p({__name:"index",setup(p){const C=e([]),w=e(null),A=e(!1),O=e(!1),E=e(""),I=e({}),T=l(()=>w.value&&C.value.length?C.value.findIndex(a=>a.id===w.value.id):0),P=l(()=>{let a=0;return Object.keys(I.value).forEach(e=>{Array.isArray(I.value[e])&&(a+=I.value[e].length)}),a});t(()=>a(this,null,function*(){yield $(),yield q(),D()}));const $=()=>a(this,null,function*(){try{const a=yield k();C.value=a||[]}catch(a){console.error("获取持有人列表失败:",a),z("获取持有人列表失败")}}),q=()=>a(this,null,function*(){try{const a=yield b();I.value=a}catch(a){console.error("获取基金数据失败:",a),z("获取基金数据失败")}}),D=()=>a(this,null,function*(){const a=yield x();w.value=C.value.find(e=>e.id===a)}),F=e=>a(this,null,function*(){const a=e.detail.value;w.value=C.value[a],yield j(w.value.id),z("默认持仓人已更新")}),L=()=>{A.value=!0},N=()=>{A.value=!1},S=()=>a(this,null,function*(){try{g("FUND_LIST"),yield q(),z("数据已恢复默认"),N()}catch(a){console.error("重置数据失败:",a),z("重置数据失败"),N()}}),U=()=>{try{const a={};if(Object.keys(I.value).forEach(e=>{const l=C.value.find(a=>a.id===e),t=l?l.name:e;if(Array.isArray(I.value[e])){const l=I.value[e].map(a=>a.code).filter(a=>a);l.length>0&&(a[t]=l)}}),0===Object.keys(a).length)return void z("暂无基金数据");let e="";Object.keys(a).forEach(l=>{e+=`${l}: ${a[l].join(", ")}\n`}),h({data:e.trim(),showToast:!1,success:()=>{z("已复制到剪贴板")},fail:()=>{z("复制失败，请重试")}})}catch(a){console.error("按持有人分类复制基金代码失败:",a),z("复制失败，请重试")}},z=a=>{E.value=a,O.value=!0,setTimeout(()=>{O.value=!1},2e3)};return(a,e)=>{const l=c,t=d,h=v,g=r;return u(),s(l,{class:"page"},{default:n(()=>[o(l,{class:"setting-container"},{default:n(()=>[o(l,{class:"setting-item"},{default:n(()=>[o(l,{class:"setting-label"},{default:n(()=>[i("恢复默认数据")]),_:1}),o(l,{class:"setting-action"},{default:n(()=>[o(t,{class:"reset-btn",onClick:L},{default:n(()=>[i("恢复默认")]),_:1})]),_:1})]),_:1}),o(l,{class:"setting-item"},{default:n(()=>[o(l,{class:"setting-label"},{default:n(()=>[i("默认持仓人设置")]),_:1}),o(l,{class:"setting-action"},{default:n(()=>[o(g,{mode:"selector",range:C.value,"range-key":"name",value:T.value,onChange:F},{default:n(()=>[o(l,{class:"picker"},{default:n(()=>[i(f(w.value?w.value.name:"请选择持仓人")+" ",1),o(h,{class:"arrow"},{default:n(()=>[i(">")]),_:1})]),_:1})]),_:1},8,["range","value"])]),_:1})]),_:1}),o(l,{class:"setting-item"},{default:n(()=>[o(l,{class:"setting-label"},{default:n(()=>[i("复制本地基金代码")]),_:1}),o(l,{class:"setting-action"},{default:n(()=>[o(t,{class:"copy-btn",onClick:U},{default:n(()=>[i("复制基金")]),_:1})]),_:1})]),_:1}),o(l,{class:"setting-item"},{default:n(()=>[o(l,{class:"setting-label"},{default:n(()=>[i("本地基金总数")]),_:1}),o(l,{class:"setting-value"},{default:n(()=>[i(f(P.value)+" 只基金",1)]),_:1})]),_:1})]),_:1}),A.value?(u(),s(l,{key:0,class:"modal-overlay",onClick:N},{default:n(()=>[o(l,{class:"modal-content",onClick:e[0]||(e[0]=_(()=>{},["stop"]))},{default:n(()=>[o(l,{class:"modal-header"},{default:n(()=>[o(h,{class:"modal-title"},{default:n(()=>[i("确认操作")]),_:1})]),_:1}),o(l,{class:"modal-body"},{default:n(()=>[o(h,{class:"modal-text"},{default:n(()=>[i("此操作会丢失本地手动添加的基金数据，是否继续？")]),_:1})]),_:1}),o(l,{class:"modal-footer"},{default:n(()=>[o(t,{class:"modal-cancel",onClick:N},{default:n(()=>[i("取消")]),_:1}),o(t,{class:"modal-confirm",onClick:S},{default:n(()=>[i("确定")]),_:1})]),_:1})]),_:1})]),_:1})):m("",!0),O.value?(u(),s(l,{key:1,class:y(["toast",{show:O.value}])},{default:n(()=>[i(f(E.value),1)]),_:1},8,["class"])):m("",!0)]),_:1})}}},[["__scopeId","data-v-73e3752a"]]);export{C as default};
