import{r as a,k as e,q as l,c as s,w as t,i as c,o as n,a as u,e as o,p as i,v as d,t as r,l as f,m as v,f as _,n as m,x as y,y as g}from"./index-D4JFg6X3.js";import{_ as h,g as k,f as p,a as b,c as w}from"./_plugin-vue_export-helper.y1xDDJgZ.js";const j=h({__name:"index",setup(h){const j=a([]),x=a(null),C=a(!1),A=a(!1),O=a(""),E=a({}),I=e(()=>x.value&&j.value.length?j.value.findIndex(a=>a.id===x.value.id):0),T=e(()=>{let a=0;return Object.keys(E.value).forEach(e=>{Array.isArray(E.value[e])&&(a+=E.value[e].length)}),a});l(async()=>{await $(),await q(),D()});const $=async()=>{try{const a=await k();j.value=a||[]}catch(a){console.error("获取持有人列表失败:",a),z("获取持有人列表失败")}},q=async()=>{try{const a=await p();E.value=a}catch(a){console.error("获取基金数据失败:",a),z("获取基金数据失败")}},D=async()=>{const a=await b();x.value=j.value.find(e=>e.id===a)},F=async a=>{const e=a.detail.value;x.value=j.value[e],await w(x.value.id),z("默认持仓人已更新")},L=()=>{C.value=!0},N=()=>{C.value=!1},S=async()=>{try{g("FUND_LIST"),await q(),z("数据已恢复默认"),N()}catch(a){console.error("重置数据失败:",a),z("重置数据失败"),N()}},U=()=>{try{const a={};if(Object.keys(E.value).forEach(e=>{const l=j.value.find(a=>a.id===e),s=l?l.name:e;if(Array.isArray(E.value[e])){const l=E.value[e].map(a=>a.code).filter(a=>a);l.length>0&&(a[s]=l)}}),0===Object.keys(a).length)return void z("暂无基金数据");let e="";Object.keys(a).forEach(l=>{e+=`${l}: ${a[l].join(", ")}\n`}),y({data:e.trim(),showToast:!1,success:()=>{z("已复制到剪贴板")},fail:()=>{z("复制失败，请重试")}})}catch(a){console.error("按持有人分类复制基金代码失败:",a),z("复制失败，请重试")}},z=a=>{O.value=a,A.value=!0,setTimeout(()=>{A.value=!1},2e3)};return(a,e)=>{const l=c,y=i,g=f,h=d;return n(),s(l,{class:"page"},{default:t(()=>[u(l,{class:"setting-container"},{default:t(()=>[u(l,{class:"setting-item"},{default:t(()=>[u(l,{class:"setting-label"},{default:t(()=>[o("恢复默认数据")]),_:1}),u(l,{class:"setting-action"},{default:t(()=>[u(y,{class:"reset-btn",onClick:L},{default:t(()=>[o("恢复默认")]),_:1})]),_:1})]),_:1}),u(l,{class:"setting-item"},{default:t(()=>[u(l,{class:"setting-label"},{default:t(()=>[o("默认持仓人设置")]),_:1}),u(l,{class:"setting-action"},{default:t(()=>[u(h,{mode:"selector",range:j.value,"range-key":"name",value:I.value,onChange:F},{default:t(()=>[u(l,{class:"picker"},{default:t(()=>[o(r(x.value?x.value.name:"请选择持仓人")+" ",1),u(g,{class:"arrow"},{default:t(()=>[o(">")]),_:1})]),_:1})]),_:1},8,["range","value"])]),_:1})]),_:1}),u(l,{class:"setting-item"},{default:t(()=>[u(l,{class:"setting-label"},{default:t(()=>[o("复制本地基金代码")]),_:1}),u(l,{class:"setting-action"},{default:t(()=>[u(y,{class:"copy-btn",onClick:U},{default:t(()=>[o("复制基金")]),_:1})]),_:1})]),_:1}),u(l,{class:"setting-item"},{default:t(()=>[u(l,{class:"setting-label"},{default:t(()=>[o("本地基金总数")]),_:1}),u(l,{class:"setting-value"},{default:t(()=>[o(r(T.value)+" 只基金",1)]),_:1})]),_:1})]),_:1}),C.value?(n(),s(l,{key:0,class:"modal-overlay",onClick:N},{default:t(()=>[u(l,{class:"modal-content",onClick:e[0]||(e[0]=v(()=>{},["stop"]))},{default:t(()=>[u(l,{class:"modal-header"},{default:t(()=>[u(g,{class:"modal-title"},{default:t(()=>[o("确认操作")]),_:1})]),_:1}),u(l,{class:"modal-body"},{default:t(()=>[u(g,{class:"modal-text"},{default:t(()=>[o("此操作会丢失本地手动添加的基金数据，是否继续？")]),_:1})]),_:1}),u(l,{class:"modal-footer"},{default:t(()=>[u(y,{class:"modal-cancel",onClick:N},{default:t(()=>[o("取消")]),_:1}),u(y,{class:"modal-confirm",onClick:S},{default:t(()=>[o("确定")]),_:1})]),_:1})]),_:1})]),_:1})):_("",!0),A.value?(n(),s(l,{key:1,class:m(["toast",{show:A.value}])},{default:t(()=>[o(r(O.value),1)]),_:1},8,["class"])):_("",!0)]),_:1})}}},[["__scopeId","data-v-73e3752a"]]);export{j as default};
